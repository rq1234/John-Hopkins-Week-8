---
title: "Regression Wk4 Assignment - mtcars"
author: "Rong Quan"
date: "3 June, 2024"
output: html_document
---
   
# Executive Summary
The Motor Trend magazine would like to look at the **mtcar** dataset and explore the relationship between transmission type and the miles per galloon (mpg). 
   
From our exploratory data analysis (boxplot and t.tests) we conclude that automatic transmission is better for mpg
  
Based on our regression model which contains the regressors: *am*, *wt*, *cyl6*, *cyl8* and *hp*, manual transmission provides 1.81 more mpg compared to automatic transmission.
   
# Exploratory Data Analysis

### Load the mtcar dataset  
```{r}
data(mtcars)
str(mtcars)
```
   
### Histogram of MPG to see if its distribution is normal  
```{r}
h <- hist(mtcars$mpg, breaks=10, col="lightgray", xlab="MPG", main="Histogram of MPG")
xfit <- seq(min(mtcars$mpg),max(mtcars$mpg), length=50)
yfit <- dnorm(xfit, mean=mean(mtcars$mpg), sd=sd(mtcars$mpg))
yfit <- yfit*diff(h$mids[1:2])*length(mtcars$mpg)
lines(xfit, yfit, col="red", lwd=2)
```
   
The distribution looks approximately normal.
    
### Boxplot of MPG by transmission type
```{r}
boxplot(mpg~am, data=mtcars,
        col = c("lightblue", "lightgreen"),
        xlab = "Transmission Type, 0=Auto, 1=Manual",
        ylab = "MPG",
        main = "MPG by Transmission Type")
tapply(mtcars$mpg, mtcars$am, mean)
```
  
Manual transmission seems to be better for MPG vs automatic transmission. The mean difference is about 7.24 miles per gallon.
  
### t test to check if the difference in mpg between transmission mode is significant
```{r}
t.test(mpg ~ am, data=mtcars)
```
     
Since the p-value is 0.001374, we reject the null hypothesis and accept that there is a difference in the mean MPG between manual transmission and automatic transmission cars. Manual transmission cars provide higher mpg. Next we try to quantify the difference using regression analysis.

# Regression Analysis
  
### Correlation test between variables
```{r}  
round(cor(mtcars, method="pearson"),2)
```

The correlation matrix shows that variables such as *wt*, *cyl*, *disp* and *hp* are highly correlated with the dependent variable *mpg* and should be included in the model. However, *cyl* and *disp* are highly correlated, so we may want to add only one of these variables to the model. 
  
### Regression models
```{r}
fit1 <- lm(mpg ~ factor(am), data=mtcars)
fit2 <- lm(mpg ~ factor(am) + wt, data=mtcars)
fit3 <- lm(mpg ~ factor(am) + wt + factor(cyl), data=mtcars)
fit4 <- lm(mpg ~ factor(am) + wt + factor(cyl) + hp, data=mtcars)
round(anova(fit1, fit2, fit3, fit4))
```
   
Based on the nested model testing, we should use fit4 since its P values is still extremely small. Let's check the residuals for fit4 for non-normality or heteroskedasticity.
   
```{r}
par(mfrow = c(2,2))
plot(fit4)   
```

The residuals vs fitted values and Q-Q plots show that is reasonable to assume the errors are normally distributed. There is no obvious signs of heteroskedasticity. We look at the estimates for fit4
    
```{r}
summary(fit4)
confint(fit4)
```  

Based on the model, manual transmission provides 1.81 more mpg than automatic transmission. A 95% confidence interval for manual transmission is between [-1.06, 4.68 ] Furthermore, *wt*, *cyl6* and *hp* confound the relationship between am and mpg.
   
